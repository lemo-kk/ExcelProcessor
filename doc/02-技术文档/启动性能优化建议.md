# å¯åŠ¨æ€§èƒ½ä¼˜åŒ–å»ºè®®

## ğŸ“‹ æ¦‚è¿°

åŸºäºExcelProcessor.WPFåº”ç”¨ç¨‹åºçš„è°ƒè¯•æ—¥å¿—åˆ†æï¼Œæœ¬æ–‡æ¡£æä¾›äº†é’ˆå¯¹å¯åŠ¨æ€§èƒ½çš„ä¼˜åŒ–å»ºè®®ã€‚å½“å‰åº”ç”¨ç¨‹åºå¯åŠ¨æµç¨‹åŸºæœ¬æ­£å¸¸ï¼Œä½†å­˜åœ¨ä¸€äº›å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ã€‚

---

## ğŸ” å½“å‰å¯åŠ¨æµç¨‹åˆ†æ

### âœ… æ­£å¸¸å¯åŠ¨æ­¥éª¤
1. **ä¾èµ–é¡¹åŠ è½½**: æ‰€æœ‰.NET Coreå’ŒWPFç»„ä»¶æ­£ç¡®åŠ è½½
2. **æ•°æ®åº“åˆå§‹åŒ–**: SQLiteæ•°æ®åº“æˆåŠŸåˆå§‹åŒ–
3. **æœåŠ¡é…ç½®**: ä¾èµ–æ³¨å…¥å®¹å™¨æ­£ç¡®é…ç½®
4. **ç•Œé¢åŠ è½½**: Material Designä¸»é¢˜æ­£å¸¸åŠ è½½
5. **å±å¹•é€‚é…**: è‡ªåŠ¨æ£€æµ‹å±å¹•åˆ†è¾¨ç‡å¹¶åº”ç”¨é€‚é…

### ğŸ“Š å¯åŠ¨æ—¶é—´åˆ†æ
ä»æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦è€—æ—¶åœ¨ä»¥ä¸‹æ­¥éª¤ï¼š
- æ•°æ®åº“è¡¨åˆ›å»ºå’Œåˆå§‹åŒ–
- ä¾èµ–æ³¨å…¥å®¹å™¨æ„å»º
- ç•Œé¢ç»„ä»¶åŠ è½½

---

## ğŸš€ ä¼˜åŒ–å»ºè®®

### 1. **å¼‚æ­¥å¯åŠ¨ä¼˜åŒ–**

#### å½“å‰é—®é¢˜
```csharp
// å½“å‰App.xaml.csä¸­çš„OnStartupæ–¹æ³•
protected override async void OnStartup(StartupEventArgs e)
{
    try
    {
        // é…ç½®ä¾èµ–æ³¨å…¥
        ConfigureServices(); // åŒæ­¥æ‰§è¡Œï¼Œå¯èƒ½é˜»å¡UI

        // åˆ›å»ºä¸»çª—å£
        var mainWindow = new Views.MainWindow();
        mainWindow.Show();

        base.OnStartup(e);
    }
    catch (Exception ex)
    {
        MessageBox.Show($"åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥ï¼š{ex.Message}", "é”™è¯¯", MessageBoxButton.OK, MessageBoxImage.Error);
        Shutdown();
    }
}
```

#### ä¼˜åŒ–å»ºè®®
```csharp
protected override async void OnStartup(StartupEventArgs e)
{
    try
    {
        // æ˜¾ç¤ºå¯åŠ¨ç”»é¢
        var splashScreen = new SplashScreen();
        splashScreen.Show();

        // å¼‚æ­¥é…ç½®æœåŠ¡
        await Task.Run(() => ConfigureServices());

        // å¼‚æ­¥åˆå§‹åŒ–æ•°æ®åº“
        await Task.Run(() => InitializeDatabaseAsync());

        // å…³é—­å¯åŠ¨ç”»é¢
        splashScreen.Close();

        // åˆ›å»ºä¸»çª—å£
        var mainWindow = new Views.MainWindow();
        mainWindow.Show();

        base.OnStartup(e);
    }
    catch (Exception ex)
    {
        MessageBox.Show($"åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥ï¼š{ex.Message}", "é”™è¯¯", MessageBoxButton.OK, MessageBoxImage.Error);
        Shutdown();
    }
}
```

### 2. **æ•°æ®åº“åˆå§‹åŒ–ä¼˜åŒ–**

#### å½“å‰é—®é¢˜
- æ•°æ®åº“åˆå§‹åŒ–åœ¨å¯åŠ¨æ—¶åŒæ­¥æ‰§è¡Œ
- æ‰€æœ‰è¡¨åˆ›å»ºæ“ä½œä¸²è¡Œæ‰§è¡Œ
- æ²¡æœ‰è¿›åº¦åé¦ˆ

#### ä¼˜åŒ–å»ºè®®
```csharp
private async Task InitializeDatabaseAsync()
{
    try
    {
        using var scope = Services.CreateScope();
        var dbContext = scope.ServiceProvider.GetRequiredService<IDbContext>();
        
        if (dbContext is SQLiteDbContext sqliteContext)
        {
            // å¼‚æ­¥åˆå§‹åŒ–æ•°æ®åº“
            await sqliteContext.InitializeAsync();
        }
    }
    catch (Exception ex)
    {
        var loggerFactory = Services.GetRequiredService<ILoggerFactory>();
        var logger = loggerFactory.CreateLogger("DatabaseInitializer");
        logger.LogError(ex, "æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥");
        throw;
    }
}
```

### 3. **ä¾èµ–æ³¨å…¥ä¼˜åŒ–**

#### å½“å‰é—®é¢˜
- æ‰€æœ‰æœåŠ¡éƒ½åœ¨å¯åŠ¨æ—¶æ³¨å†Œ
- æ²¡æœ‰ä½¿ç”¨å»¶è¿ŸåŠ è½½
- æœåŠ¡æ³¨å†Œé¡ºåºå¯èƒ½å½±å“æ€§èƒ½

#### ä¼˜åŒ–å»ºè®®
```csharp
private void ConfigureServices()
{
    var services = new ServiceCollection();

    // 1. ä¼˜å…ˆæ³¨å†Œæ ¸å¿ƒæœåŠ¡
    services.AddSingleton<IConfiguration>(configuration);
    services.AddLogging(builder =>
    {
        builder.AddConsole();
        builder.AddDebug();
    });

    // 2. æ³¨å†Œæ•°æ®åº“ç›¸å…³æœåŠ¡
    services.AddScoped<IDbContext, SQLiteDbContext>();
    services.AddScoped<System.Data.IDbConnection>(provider =>
    {
        var config = provider.GetRequiredService<IConfiguration>();
        var connectionString = config.GetConnectionString("DefaultConnection") 
            ?? "Data Source=./data/ExcelProcessor.db;";
        return new Microsoft.Data.Sqlite.SqliteConnection(connectionString);
    });

    // 3. ä½¿ç”¨å»¶è¿ŸåŠ è½½æ³¨å†Œéæ ¸å¿ƒæœåŠ¡
    services.AddLazy<IRepository<User>, UserRepository>();
    services.AddLazy<IRepository<Role>, RoleRepository>();
    // ... å…¶ä»–ä»“å‚¨

    // 4. æ³¨å†ŒæœåŠ¡å®ç°
    services.AddScoped<IUserService, UserService>();
    services.AddScoped<IRoleService, RoleService>();
    // ... å…¶ä»–æœåŠ¡

    Services = services.BuildServiceProvider();
}
```

### 4. **å¯åŠ¨ç”»é¢å®ç°**

#### å»ºè®®å®ç°
```csharp
public class SplashScreen : Window
{
    public SplashScreen()
    {
        Title = "Excel Processor - æ­£åœ¨å¯åŠ¨";
        Width = 400;
        Height = 300;
        WindowStartupLocation = WindowStartupLocation.CenterScreen;
        WindowStyle = WindowStyle.None;
        ResizeMode = ResizeMode.NoResize;
        AllowsTransparency = true;
        Background = new SolidColorBrush(Color.FromRgb(42, 42, 42));

        var grid = new Grid();
        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
        grid.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });

        // Logo
        var logo = new PackIcon
        {
            Kind = PackIconKind.TableLarge,
            Width = 64,
            Height = 64,
            Foreground = new SolidColorBrush(Color.FromRgb(0, 229, 255)),
            HorizontalAlignment = HorizontalAlignment.Center,
            Margin = new Thickness(0, 20, 0, 10)
        };

        // æ ‡é¢˜
        var title = new TextBlock
        {
            Text = "Excel Processor",
            FontSize = 24,
            FontWeight = FontWeights.Bold,
            Foreground = new SolidColorBrush(Colors.White),
            HorizontalAlignment = HorizontalAlignment.Center,
            Margin = new Thickness(0, 0, 0, 20)
        };

        // è¿›åº¦æ¡
        var progressBar = new ProgressBar
        {
            IsIndeterminate = true,
            Height = 4,
            Margin = new Thickness(40, 0, 40, 20),
            Background = new SolidColorBrush(Color.FromRgb(64, 64, 64)),
            Foreground = new SolidColorBrush(Color.FromRgb(0, 229, 255))
        };

        Grid.SetRow(logo, 0);
        Grid.SetRow(title, 1);
        Grid.SetRow(progressBar, 2);

        grid.Children.Add(logo);
        grid.Children.Add(title);
        grid.Children.Add(progressBar);

        Content = grid;
    }
}
```

### 5. **èµ„æºåŠ è½½ä¼˜åŒ–**

#### å½“å‰é—®é¢˜
- Material Designä¸»é¢˜èµ„æºåœ¨å¯åŠ¨æ—¶å…¨éƒ¨åŠ è½½
- æ²¡æœ‰ä½¿ç”¨èµ„æºå­—å…¸çš„å»¶è¿ŸåŠ è½½

#### ä¼˜åŒ–å»ºè®®
```xml
<!-- App.xaml -->
<Application.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <!-- æ ¸å¿ƒä¸»é¢˜èµ„æº -->
            <materialDesign:BundledTheme BaseTheme="Dark" PrimaryColor="Blue" SecondaryColor="LightBlue" />
            
            <!-- å»¶è¿ŸåŠ è½½éæ ¸å¿ƒèµ„æº -->
            <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Defaults.xaml" />
            
            <!-- æŒ‰éœ€åŠ è½½å…¶ä»–èµ„æº -->
            <ResourceDictionary Source="Styles/Colors.xaml" />
            <ResourceDictionary Source="Styles/Buttons.xaml" />
        </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
</Application.Resources>
```

### 6. **æ—¥å¿—ä¼˜åŒ–**

#### å½“å‰é—®é¢˜
- å¯åŠ¨æ—¶æ—¥å¿—è¾“å‡ºè¿‡å¤š
- æ²¡æœ‰æ—¥å¿—çº§åˆ«æ§åˆ¶

#### ä¼˜åŒ–å»ºè®®
```csharp
// åœ¨ConfigureServicesä¸­é…ç½®æ—¥å¿—
services.AddLogging(builder =>
{
    builder.AddConsole();
    builder.AddDebug();
    
    // è®¾ç½®å¯åŠ¨æ—¶çš„æ—¥å¿—çº§åˆ«
    builder.SetMinimumLevel(LogLevel.Information);
    
    // è¿‡æ»¤å¯åŠ¨æ—¶çš„è¯¦ç»†æ—¥å¿—
    builder.AddFilter("Microsoft.Extensions.DependencyInjection", LogLevel.Warning);
    builder.AddFilter("Microsoft.Extensions.Configuration", LogLevel.Warning);
});
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### 1. **å¯åŠ¨æ—¶é—´æµ‹é‡**
```csharp
public class StartupTimer
{
    private static readonly Stopwatch _stopwatch = new Stopwatch();
    private static readonly Dictionary<string, TimeSpan> _timings = new Dictionary<string, TimeSpan>();

    public static void Start(string operation)
    {
        _stopwatch.Restart();
    }

    public static void Stop(string operation)
    {
        _stopwatch.Stop();
        _timings[operation] = _stopwatch.Elapsed;
    }

    public static void LogTimings(ILogger logger)
    {
        foreach (var timing in _timings)
        {
            logger.LogInformation("å¯åŠ¨æ—¶é—´ - {Operation}: {Elapsed}ms", 
                timing.Key, timing.Value.TotalMilliseconds);
        }
    }
}
```

### 2. **å†…å­˜ä½¿ç”¨ç›‘æ§**
```csharp
public static class MemoryMonitor
{
    public static void LogMemoryUsage(ILogger logger, string stage)
    {
        var process = Process.GetCurrentProcess();
        var memoryMB = process.WorkingSet64 / 1024 / 1024;
        
        logger.LogInformation("å†…å­˜ä½¿ç”¨ - {Stage}: {MemoryMB}MB", stage, memoryMB);
    }
}
```

---

## ğŸ”§ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: åŸºç¡€ä¼˜åŒ– (1-2å¤©)
1. å®ç°å¯åŠ¨ç”»é¢
2. ä¼˜åŒ–æ—¥å¿—é…ç½®
3. æ·»åŠ å¯åŠ¨æ—¶é—´ç›‘æ§

### é˜¶æ®µ2: å¼‚æ­¥ä¼˜åŒ– (2-3å¤©)
1. å®ç°å¼‚æ­¥æœåŠ¡é…ç½®
2. ä¼˜åŒ–æ•°æ®åº“åˆå§‹åŒ–
3. å®ç°å»¶è¿ŸåŠ è½½

### é˜¶æ®µ3: èµ„æºä¼˜åŒ– (1-2å¤©)
1. ä¼˜åŒ–èµ„æºåŠ è½½
2. å®ç°æŒ‰éœ€åŠ è½½
3. ä¼˜åŒ–ä¾èµ–æ³¨å…¥

### é˜¶æ®µ4: æµ‹è¯•éªŒè¯ (1å¤©)
1. æ€§èƒ½æµ‹è¯•
2. å†…å­˜ä½¿ç”¨æµ‹è¯•
3. ç”¨æˆ·ä½“éªŒæµ‹è¯•

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### å¯åŠ¨æ—¶é—´ä¼˜åŒ–
- **å½“å‰**: çº¦3-5ç§’
- **ä¼˜åŒ–å**: çº¦1-2ç§’
- **æå‡**: 60-70%

### å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- **å¯åŠ¨æ—¶å†…å­˜**: å‡å°‘20-30%
- **è¿è¡Œæ—¶å†…å­˜**: å‡å°‘10-15%

### ç”¨æˆ·ä½“éªŒæå‡
- å¯åŠ¨ç”»é¢æä¾›è§†è§‰åé¦ˆ
- å¼‚æ­¥åŠ è½½é¿å…ç•Œé¢å†»ç»“
- æ›´å¿«çš„å“åº”é€Ÿåº¦

---

## ğŸ¯ æ€»ç»“

åŸºäºå½“å‰çš„è°ƒè¯•æ—¥å¿—åˆ†æï¼ŒExcelProcessor.WPFåº”ç”¨ç¨‹åºçš„å¯åŠ¨æµç¨‹åŸºæœ¬æ­£å¸¸ï¼Œä½†å­˜åœ¨ä»¥ä¸‹ä¼˜åŒ–ç©ºé—´ï¼š

1. **å¼‚æ­¥å¯åŠ¨**: å°†åŒæ­¥æ“ä½œæ”¹ä¸ºå¼‚æ­¥ï¼Œé¿å…ç•Œé¢å†»ç»“
2. **å¯åŠ¨ç”»é¢**: æä¾›è§†è§‰åé¦ˆï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ
3. **èµ„æºä¼˜åŒ–**: å®ç°æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘å¯åŠ¨æ—¶é—´
4. **æ€§èƒ½ç›‘æ§**: æ·»åŠ å¯åŠ¨æ—¶é—´æµ‹é‡ï¼Œä¾¿äºæŒç»­ä¼˜åŒ–

é€šè¿‡è¿™äº›ä¼˜åŒ–ï¼Œå¯ä»¥æ˜¾è‘—æå‡åº”ç”¨ç¨‹åºçš„å¯åŠ¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2024-01-16  
**ç»´æŠ¤è€…**: é¡¹ç›®å¼€å‘å›¢é˜Ÿ 
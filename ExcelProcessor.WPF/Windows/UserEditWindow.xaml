<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="ExcelProcessor.WPF.Windows.UserEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="{Binding WindowTitle}"
        Height="600" 
        Width="500"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{StaticResource MaterialDesignPaper}"
        TextElement.Foreground="{StaticResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{StaticResource MaterialDesignFont}">

    <Window.Resources>
        <Style x:Key="FormLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignBody1TextBlock}">
            <Setter Property="Foreground" Value="{StaticResource MaterialDesignBodyLight}" />
            <Setter Property="Margin" Value="0,0,0,8" />
            <Setter Property="FontWeight" Value="Medium" />
        </Style>

        <Style x:Key="FormInputStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Margin" Value="0,0,0,16" />
            <Setter Property="VerticalAlignment" Value="Top" />
        </Style>

        <Style x:Key="FormComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource MaterialDesignOutlinedComboBox}">
            <Setter Property="Margin" Value="0,0,0,16" />
            <Setter Property="VerticalAlignment" Value="Top" />
        </Style>

        <Style x:Key="FormButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="Margin" Value="8,0,0,0" />
            <Setter Property="MinWidth" Value="100" />
        </Style>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <Border Grid.Row="0" 
                Background="{StaticResource MaterialDesignCardBackground}"
                CornerRadius="8"
                Padding="20"
                Margin="0,0,0,20">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <materialDesign:PackIcon Kind="AccountEdit" 
                                           Width="24" 
                                           Height="24" 
                                           Foreground="{StaticResource MaterialDesignPrimary}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0" />
                    <TextBlock Text="{Binding WindowTitle}" 
                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                             VerticalAlignment="Center" />
                </StackPanel>
                <TextBlock Text="{Binding WindowDescription}" 
                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                         Foreground="{StaticResource MaterialDesignBodyLight}" />
            </StackPanel>
        </Border>

        <!-- 表单内容 -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel>
                <!-- 用户名 -->
                <TextBlock Text="用户名 *" Style="{StaticResource FormLabelStyle}" />
                <TextBox x:Name="UsernameTextBox"
                       Style="{StaticResource FormInputStyle}"
                       materialDesign:HintAssist.Hint="请输入用户名"
                       Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                       IsEnabled="{Binding IsUsernameEditable}" />

                <!-- 显示名称 -->
                <TextBlock Text="显示名称 *" Style="{StaticResource FormLabelStyle}" />
                <TextBox x:Name="DisplayNameTextBox"
                       Style="{StaticResource FormInputStyle}"
                       materialDesign:HintAssist.Hint="请输入显示名称"
                       Text="{Binding DisplayName, UpdateSourceTrigger=PropertyChanged}" />

                <!-- 邮箱 -->
                <TextBlock Text="邮箱地址" Style="{StaticResource FormLabelStyle}" />
                <TextBox x:Name="EmailTextBox"
                       Style="{StaticResource FormInputStyle}"
                       materialDesign:HintAssist.Hint="请输入邮箱地址"
                       Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}" />

                <!-- 角色 -->
                <TextBlock Text="用户角色 *" Style="{StaticResource FormLabelStyle}" />
                <ComboBox x:Name="RoleComboBox"
                        Style="{StaticResource FormComboBoxStyle}"
                        materialDesign:HintAssist.Hint="请选择用户角色"
                        ItemsSource="{Binding AvailableRoles}"
                        SelectedItem="{Binding SelectedRole}"
                        DisplayMemberPath="Name"
                        SelectedValuePath="Code" />

                <!-- 密码（仅新增用户时显示） -->
                <TextBlock Text="密码" 
                         Style="{StaticResource FormLabelStyle}"
                         Visibility="{Binding IsNewUser, Converter={StaticResource BooleanToVisibilityConverter}}" />
                <PasswordBox x:Name="PasswordBox"
                          Style="{StaticResource FormInputStyle}"
                          materialDesign:HintAssist.Hint="请输入密码"
                          Visibility="{Binding IsNewUser, Converter={StaticResource BooleanToVisibilityConverter}}" />

                <!-- 确认密码（仅新增用户时显示） -->
                <TextBlock Text="确认密码" 
                         Style="{StaticResource FormLabelStyle}"
                         Visibility="{Binding IsNewUser, Converter={StaticResource BooleanToVisibilityConverter}}" />
                <PasswordBox x:Name="ConfirmPasswordBox"
                          Style="{StaticResource FormInputStyle}"
                          materialDesign:HintAssist.Hint="请再次输入密码"
                          Visibility="{Binding IsNewUser, Converter={StaticResource BooleanToVisibilityConverter}}" />

                <!-- 用户状态 -->
                <TextBlock Text="用户状态" Style="{StaticResource FormLabelStyle}" />
                <ComboBox x:Name="StatusComboBox"
                        Style="{StaticResource FormComboBoxStyle}"
                        materialDesign:HintAssist.Hint="请选择用户状态"
                        ItemsSource="{Binding UserStatuses}"
                        SelectedItem="{Binding SelectedStatus}" />

                <!-- 备注 -->
                <TextBlock Text="备注" Style="{StaticResource FormLabelStyle}" />
                <TextBox x:Name="RemarksTextBox"
                       Style="{StaticResource FormInputStyle}"
                       materialDesign:HintAssist.Hint="请输入备注信息"
                       Text="{Binding Remarks, UpdateSourceTrigger=PropertyChanged}"
                       AcceptsReturn="True"
                       TextWrapping="Wrap"
                       Height="80"
                       VerticalScrollBarVisibility="Auto" />
            </StackPanel>
        </ScrollViewer>

        <!-- 按钮栏 -->
        <Border Grid.Row="2" 
                Background="{StaticResource MaterialDesignCardBackground}"
                CornerRadius="8"
                Padding="20"
                Margin="0,20,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="CancelButton"
                      Content="取消"
                      Style="{StaticResource MaterialDesignOutlinedButton}"
                      Click="CancelButton_Click" />
                
                <Button x:Name="SaveButton"
                      Content="保存"
                      Style="{StaticResource FormButtonStyle}"
                      Click="SaveButton_Click"
                      IsEnabled="{Binding IsFormValid}" />
            </StackPanel>
        </Border>
    </Grid>
</Window> 
<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="ExcelProcessor.WPF.Dialogs.UserEditDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="{Binding DialogTitle}"
        Width="700"
        Height="750"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{StaticResource MaterialDesignPaper}"
        TextElement.Foreground="{StaticResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{StaticResource MaterialDesignFont}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <Border Grid.Row="0" 
                Background="{StaticResource CyberBlueBrush}"
                Padding="24,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="AccountEdit" 
                                           Width="28" 
                                           Height="28" 
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           Margin="0,0,16,0" />
                    <TextBlock Text="{Binding DialogTitle}" 
                             FontSize="20" 
                             FontWeight="SemiBold"
                             Foreground="White"
                             VerticalAlignment="Center" />
                </StackPanel>

                <Button Grid.Column="1"
                      Style="{StaticResource MaterialDesignIconButton}"
                      Foreground="White"
                      materialDesign:ButtonAssist.CornerRadius="4"
                      Click="CloseButton_Click">
                    <materialDesign:PackIcon Kind="Close" />
                </Button>
            </Grid>
        </Border>

        <!-- 内容区域 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="24">
            <StackPanel>
                <!-- 用户头像和基本信息 -->
                <Border Style="{StaticResource ConfigGroupStyle}" Margin="0,0,0,24">
                    <Grid Margin="20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- 用户头像 -->
                        <Border Grid.Column="0" 
                                Width="80" 
                                Height="80" 
                                Background="{StaticResource CyberBlueBrush}"
                                CornerRadius="40"
                                Margin="0,0,20,0">
                            <materialDesign:PackIcon Kind="Account" 
                                                   Width="40" 
                                                   Height="40" 
                                                   Foreground="White"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center" />
                        </Border>

                        <!-- 基本信息 -->
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="基本信息" 
                                     Style="{StaticResource ConfigGroupTitleStyle}"
                                     FontSize="18" 
                                     Margin="0,0,0,16" />
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="20" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- 用户名 -->
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="用户名 *" 
                                             Style="{StaticResource MaterialDesignBody2TextBlock}"
                                             Margin="0,0,0,8" />
                                    <TextBox x:Name="UsernameTextBox"
                                           Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                           materialDesign:HintAssist.Hint="请输入用户名"
                                           Text="{Binding User.Username, UpdateSourceTrigger=PropertyChanged}"
                                           Margin="0,0,0,16" />
                                </StackPanel>

                                <!-- 显示名称 -->
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="显示名称 *" 
                                             Style="{StaticResource MaterialDesignBody2TextBlock}"
                                             Margin="0,0,0,8" />
                                    <TextBox x:Name="DisplayNameTextBox"
                                           Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                           materialDesign:HintAssist.Hint="请输入显示名称"
                                           Text="{Binding User.DisplayName, UpdateSourceTrigger=PropertyChanged}"
                                           Margin="0,0,0,16" />
                                </StackPanel>
                            </Grid>

                            <!-- 邮箱 -->
                            <TextBlock Text="邮箱地址" 
                                     Style="{StaticResource MaterialDesignBody2TextBlock}"
                                     Margin="0,0,0,8" />
                            <TextBox x:Name="EmailTextBox"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   materialDesign:HintAssist.Hint="请输入邮箱地址"
                                   Text="{Binding User.Email, UpdateSourceTrigger=PropertyChanged}"
                                   Margin="0,0,0,16" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- 账户设置 -->
                <Border Style="{StaticResource ConfigGroupStyle}" Margin="0,0,0,24">
                    <StackPanel Margin="20">
                        <TextBlock Text="账户设置" 
                                 Style="{StaticResource ConfigGroupTitleStyle}"
                                 FontSize="18" 
                                 Margin="0,0,0,20" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="20" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- 左侧设置 -->
                            <StackPanel Grid.Column="0">
                                <!-- 角色 -->
                                <TextBlock Text="用户角色 *" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8" />
                                <ComboBox x:Name="RoleComboBox"
                                        Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                        materialDesign:HintAssist.Hint="请选择用户角色"
                                        SelectedItem="{Binding SelectedRole}"
                                        ItemsSource="{Binding AvailableRoles}"
                                        DisplayMemberPath="Name"
                                        Margin="0,0,0,16" />

                                <!-- 用户状态 -->
                                <TextBlock Text="用户状态" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8" />
                                <ComboBox x:Name="StatusComboBox"
                                        Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                        materialDesign:HintAssist.Hint="请选择用户状态"
                                        SelectedItem="{Binding User.Status}"
                                        ItemsSource="{Binding UserStatuses}"
                                        Margin="0,0,0,16" />
                            </StackPanel>

                            <!-- 右侧设置 -->
                            <StackPanel Grid.Column="2">
                                <!-- 密码 -->
                                <TextBlock Text="登录密码" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8" />
                                <PasswordBox x:Name="PasswordBox"
                                          Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                                          materialDesign:HintAssist.Hint="请输入密码（留空则不修改）"
                                          Margin="0,0,0,16" />

                                <!-- 确认密码 -->
                                <TextBlock Text="确认密码" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8" />
                                <PasswordBox x:Name="ConfirmPasswordBox"
                                          Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                                          materialDesign:HintAssist.Hint="请再次输入密码"
                                          Margin="0,0,0,16" />

                                <!-- 启用状态 -->
                                <CheckBox x:Name="IsEnabledCheckBox"
                                        Content="启用此用户账户"
                                        IsChecked="{Binding User.IsEnabled}"
                                        Style="{StaticResource MaterialDesignCheckBox}"
                                        Margin="0,0,0,16" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- 备注信息 -->
                <Border Style="{StaticResource ConfigGroupStyle}" Margin="0,0,0,24">
                    <StackPanel Margin="20">
                        <TextBlock Text="备注信息" 
                                 Style="{StaticResource ConfigGroupTitleStyle}"
                                 FontSize="18" 
                                 Margin="0,0,0,16" />

                        <TextBox x:Name="RemarksTextBox"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               materialDesign:HintAssist.Hint="请输入备注信息（可选）"
                               Text="{Binding User.Remarks, UpdateSourceTrigger=PropertyChanged}"
                               AcceptsReturn="True"
                               TextWrapping="Wrap"
                               Height="80"
                               VerticalScrollBarVisibility="Auto"
                               Margin="0,0,0,16" />
                    </StackPanel>
                </Border>

                <!-- 验证信息 -->
                <Border Background="{StaticResource MaterialDesignError}"
                      CornerRadius="8"
                      Padding="16"
                      Margin="0,0,0,16"
                      Visibility="{Binding HasValidationErrors, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <materialDesign:PackIcon Kind="AlertCircle" 
                                                   Width="20" 
                                                   Height="20" 
                                                   Foreground="White"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0" />
                            <TextBlock Text="请修正以下错误"
                                     FontWeight="Bold"
                                     Foreground="White" />
                        </StackPanel>
                        <ItemsControl ItemsSource="{Binding ValidationErrors}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                             Foreground="White"
                                             Margin="0,0,0,4" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- 底部按钮 -->
        <Border Grid.Row="2" 
                Background="{StaticResource MaterialDesignToolBarBackground}"
                Padding="24,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 左侧信息 -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Information" 
                                           Width="16" 
                                           Height="16" 
                                           Foreground="{StaticResource MaterialDesignBodyLight}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0" />
                    <TextBlock Text="* 表示必填字段" 
                             Foreground="{StaticResource MaterialDesignBodyLight}"
                             VerticalAlignment="Center" />
                </StackPanel>

                <!-- 右侧按钮 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="CancelButton"
                          Content="取消"
                          Style="{StaticResource MaterialDesignOutlinedButton}"
                          Click="CancelButton_Click"
                          Margin="0,0,12,0" />
                    
                    <Button x:Name="SaveButton"
                          Content="保存用户"
                          Style="{StaticResource MaterialDesignRaisedButton}"
                          Background="{StaticResource CyberBlueBrush}"
                          Click="SaveButton_Click" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window> 
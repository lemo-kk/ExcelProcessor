<Window x:Class="ExcelProcessor.WPF.Dialogs.JobExecutionHistoryDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ExcelProcessor.WPF.Dialogs"
        Title="执行记录" Height="700" Width="1200"
        WindowStartupLocation="CenterOwner"
        Background="#1E1E1E">
    <Window.Resources>
        <local:SuccessCountConverter x:Key="SuccessCountConverter" />
        <local:ErrorCountConverter x:Key="ErrorCountConverter" />
    </Window.Resources>
    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition Width="12" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        
        <!-- 左侧：执行记录列表 -->
        <Border Grid.Column="0" Background="#252526" CornerRadius="6" Padding="8">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="执行记录" Foreground="#E0E0E0" FontSize="14" FontWeight="SemiBold" />
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="刷新" Margin="8,0,0,0" Padding="10,4" Click="RefreshExecutions_Click"
                                Background="#2A2A2A" Foreground="#CCCCCC" />
                    </StackPanel>
                </StackPanel>
                <ListView ItemsSource="{Binding Executions}" SelectedItem="{Binding SelectedExecution, Mode=TwoWay}" BorderThickness="0" SelectionChanged="Executions_SelectionChanged">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#2D2D30" CornerRadius="4" Padding="8" Margin="0,0,0,8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="{Binding StartTime, StringFormat=yyyy-MM-dd HH:mm:ss}" Foreground="#E0E0E0" FontSize="12" />
                                        <TextBlock Text="{Binding Status}" Foreground="#AAAAAA" FontSize="11" />
                                        <TextBlock Text="{Binding ExecutedBy}" Foreground="#888888" FontSize="10" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Duration}" Foreground="#AAAAAA" FontSize="11" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </DockPanel>
        </Border>

        <!-- 分隔 -->
        <Grid Grid.Column="1" />

        <!-- 右侧：步骤明细 -->
        <Border Grid.Column="2" Background="#252526" CornerRadius="6" Padding="8">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="步骤执行明细" Foreground="#E0E0E0" FontSize="14" FontWeight="SemiBold" />
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="复制错误" Margin="8,0,0,0" Padding="10,4" Click="CopyError_Click"
                                Background="#2A2A2A" Foreground="#CCCCCC" />
                    </StackPanel>
                </StackPanel>
                <DataGrid ItemsSource="{Binding StepExecutions}"
                          AutoGenerateColumns="False"
                          HeadersVisibility="Column"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          IsReadOnly="True"
                          Background="#252526"
                          Foreground="#E0E0E0"
                          BorderThickness="0"
                          GridLinesVisibility="Horizontal"
                          HorizontalGridLinesBrush="#3F3F3F"
                          VerticalGridLinesBrush="#3F3F3F"
                          RowBackground="#252526"
                          AlternatingRowBackground="#2A2A2A"
                          RowHeaderWidth="0"
                          ScrollViewer.HorizontalScrollBarVisibility="Auto"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          ScrollViewer.CanContentScroll="True"
                          MinRowHeight="30">
                    <DataGrid.ContextMenu>
                        <ContextMenu Background="#2A2A2A" Foreground="#E0E0E0">
                            <MenuItem Header="复制内容" Click="CopyCellContent_Click" Background="#2A2A2A" Foreground="#E0E0E0" />
                            <MenuItem Header="复制行信息" Click="CopyRowInfo_Click" Background="#2A2A2A" Foreground="#E0E0E0" />
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="#" Binding="{Binding StepOrder}" Width="50" />
                        <DataGridTemplateColumn Header="步骤名称" Width="150">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding StepName}" 
                                               TextWrapping="Wrap" 
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding StepName}"
                                               VerticalAlignment="Center" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="类型" Binding="{Binding StepType}" Width="120" />
                        <DataGridTextColumn Header="开始时间" Binding="{Binding StartTime, StringFormat=yyyy-MM-dd HH:mm:ss}" Width="140" />
                        <DataGridTextColumn Header="结束时间" Binding="{Binding EndTime, StringFormat=yyyy-MM-dd HH:mm:ss}" Width="140" />
                        <DataGridTextColumn Header="耗时" Binding="{Binding Duration}" Width="80" />
                        <DataGridTextColumn Header="状态" Binding="{Binding Status}" Width="100" />
                        <DataGridTemplateColumn Header="结果信息" Width="200">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding ResultMessage}" 
                                               TextWrapping="Wrap" 
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding ResultMessage}"
                                               MaxHeight="60"
                                               VerticalAlignment="Center" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="错误信息" Width="300">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding ErrorMessage}" 
                                               TextWrapping="Wrap" 
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding ErrorMessage}"
                                               MaxHeight="60"
                                               Foreground="#FF6B6B"
                                               VerticalAlignment="Center" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Padding" Value="8,4" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Border Padding="{TemplateBinding Padding}" 
                                                Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}">
                                            <ContentPresenter />
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGrid.CellStyle>
                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#3F3F3F" />
                            <Setter Property="Foreground" Value="#E0E0E0" />
                            <Setter Property="Padding" Value="8,6" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                        </Style>
                    </DataGrid.ColumnHeaderStyle>
                </DataGrid>
                
                <!-- 状态栏 -->
                <Border DockPanel.Dock="Bottom" Background="#1E1E1E" Padding="8,4" Margin="0,8,0,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="总计: " Foreground="#AAAAAA" FontSize="11" />
                        <TextBlock Text="{Binding StepExecutions.Count}" Foreground="#E0E0E0" FontSize="11" FontWeight="SemiBold" />
                        <TextBlock Text=" 个步骤" Foreground="#AAAAAA" FontSize="11" Margin="0,0,16,0" />
                        
                        <TextBlock Text="成功: " Foreground="#AAAAAA" FontSize="11" />
                        <TextBlock Text="{Binding StepExecutions.Count, Converter={StaticResource SuccessCountConverter}}" Foreground="#4CAF50" FontSize="11" FontWeight="SemiBold" />
                        <TextBlock Text=" 个" Foreground="#AAAAAA" FontSize="11" Margin="0,0,16,0" />
                        
                        <TextBlock Text="失败: " Foreground="#AAAAAA" FontSize="11" />
                        <TextBlock Text="{Binding StepExecutions.Count, Converter={StaticResource ErrorCountConverter}}" Foreground="#FF6B6B" FontSize="11" FontWeight="SemiBold" />
                        <TextBlock Text=" 个" Foreground="#AAAAAA" FontSize="11" />
                    </StackPanel>
                </Border>
            </DockPanel>
        </Border>
    </Grid>
</Window> 
<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="ExcelProcessor.WPF.Pages.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converters="clr-namespace:ExcelProcessor.WPF.Converters"
      Title="首页"
      Background="Transparent">

    <Page.Resources>
        <!-- 转换器资源 -->
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <converters:CardWidthConverter x:Key="CardWidthConverter" />
        <converters:TextWidthConverter x:Key="TextWidthConverter" />
    </Page.Resources>

    <!-- 主布局容器 -->
    <Grid>
        <!-- 主内容区域 -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="20">
            <StackPanel>
                <!-- 欢迎信息 -->
                <TextBlock Text="欢迎使用 Excel 处理系统"
                         FontSize="24"
                         FontWeight="Bold"
                         Foreground="White"
                         HorizontalAlignment="Center"
                         Margin="0,0,0,8" />
                
                <TextBlock Text="高效、智能的Excel数据处理解决方案"
                         FontSize="14"
                         Foreground="#CCCCCC"
                         HorizontalAlignment="Center"
                         Margin="0,0,0,32" />

                <!-- 手动执行作业标题行 -->
                <StackPanel Orientation="Horizontal" 
                           HorizontalAlignment="Left" 
                           Margin="0,0,0,16"
                           VerticalAlignment="Center">
                    <TextBlock Text="手动执行作业" 
                             FontSize="18" 
                             FontWeight="SemiBold"
                             Foreground="{StaticResource CyberBlueBrush}"
                             VerticalAlignment="Center" />
                    <TextBlock Text="{Binding ManualJobsCount, StringFormat='共 {0} 个'}"
                             FontSize="12"
                             Foreground="#888888"
                             VerticalAlignment="Center"
                             Margin="8,0,0,0" />
                </StackPanel>

                <!-- 作业卡片容器 -->
                <ItemsControl ItemsSource="{Binding ManualJobs}"
                             Margin="0,0,0,20">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" 
                                      HorizontalAlignment="Stretch"
                                      Width="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                                      ItemWidth="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource AncestorType=ScrollViewer}, Converter={StaticResource CardWidthConverter}}"
                                      ItemHeight="170" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#2A2A2A"
                                    CornerRadius="12"
                                    Margin="6"
                                    MinWidth="240"
                                    MaxWidth="320"
                                    Height="170"
                                    Cursor="Hand"
                                    Effect="{StaticResource MaterialDesignElevationShadow1}"
                                    MouseLeftButtonDown="ManualJobCard_Click"
                                    Tag="{Binding Id}">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#3A3A3A" />
                                                <Setter Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="{StaticResource CyberBlue}" BlurRadius="15" ShadowDepth="2" Opacity="0.4" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                
                                <Grid Margin="18">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    
                                    <!-- 顶部：图标和作业名称 -->
                                    <StackPanel Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,10">
                                        <materialDesign:PackIcon Kind="PlayCircle" 
                                                               Width="32" 
                                                               Height="32"
                                                               Foreground="{StaticResource HighlightPurpleBrush}"
                                                               HorizontalAlignment="Center" />
                                        <TextBlock Text="{Binding Name}" 
                                                 FontSize="14" 
                                                 FontWeight="SemiBold"
                                                 Foreground="White"
                                                 HorizontalAlignment="Center"
                                                 Margin="0,8,0,0"
                                                 TextWrapping="Wrap"
                                                 MaxWidth="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource AncestorType=Border}, Converter={StaticResource TextWidthConverter}}"
                                                 TextAlignment="Center"
                                                 LineHeight="18" />
                                    </StackPanel>
                                    
                                    <!-- 中间：作业描述 -->
                                    <TextBlock Grid.Row="1" 
                                             Text="{Binding Description}" 
                                             FontSize="11"
                                             Foreground="#CCCCCC"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             TextWrapping="Wrap"
                                             MaxWidth="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource AncestorType=Border}, Converter={StaticResource TextWidthConverter}}"
                                             MaxHeight="45"
                                             TextTrimming="CharacterEllipsis"
                                             TextAlignment="Center"
                                             LineHeight="15" />
                                    
                                    <!-- 底部：标签和状态 -->
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                        <Border Background="#333333" 
                                                CornerRadius="6" 
                                                Padding="6,3" 
                                                Margin="2">
                                            <TextBlock Text="{Binding Type}" 
                                                     FontSize="9" 
                                                     FontWeight="Medium"
                                                     Foreground="#CCCCCC" />
                                        </Border>
                                        <Border Background="#333333" 
                                                CornerRadius="6" 
                                                Padding="6,3" 
                                                Margin="2">
                                            <TextBlock Text="{Binding Priority}" 
                                                     FontSize="9" 
                                                     FontWeight="Medium"
                                                     Foreground="#CCCCCC" />
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- 如果没有手动执行作业，显示提示信息 -->
                <Border x:Name="NoManualJobsBorder"
                        Background="#2A2A2A"
                        CornerRadius="12"
                        Padding="50,30"
                        Margin="0,0,0,20"
                        Effect="{StaticResource MaterialDesignElevationShadow1}"
                        Visibility="{Binding ManualJobsCount, Converter={StaticResource CountToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center">
                        <materialDesign:PackIcon Kind="PlayCircleOutline" 
                                               Width="56" 
                                               Height="56"
                                               Foreground="#666666"
                                               HorizontalAlignment="Center" />
                        <TextBlock Text="暂无手动执行作业" 
                                 FontSize="18" 
                                 FontWeight="SemiBold"
                                 Foreground="#666666"
                                 HorizontalAlignment="Center"
                                 Margin="0,16,0,10" />
                        <TextBlock Text="请先创建手动执行的作业配置，创建后即可在此处快速执行" 
                                 FontSize="13"
                                 Foreground="#888888"
                                 HorizontalAlignment="Center"
                                 TextWrapping="Wrap"
                                 TextAlignment="Center"
                                 MaxWidth="400"
                                 LineHeight="18" />
                    </StackPanel>
                </Border>

                <!-- 最近执行任务 -->
                <TextBlock Text="最近执行任务" 
                         FontSize="18" 
                         FontWeight="SemiBold"
                         Foreground="{StaticResource CyberBlueBrush}"
                         Margin="0,0,0,16" />

                <Border Background="#2A2A2A"
                        CornerRadius="8"
                        Padding="20"
                        Margin="0,0,0,20"
                        Effect="{StaticResource MaterialDesignElevationShadow1}">
                    
                    <DataGrid x:Name="RecentTasksDataGrid"
                             Style="{StaticResource CustomDataGridStyle}"
                             ColumnHeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"
                             CellStyle="{StaticResource CustomDataGridCellStyle}"
                             RowStyle="{StaticResource CustomDataGridRowStyle}"
                             Height="200"
                             AutoGenerateColumns="False"
                             IsReadOnly="True">
                        
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="作业名称" Binding="{Binding JobName}" Width="*" />
                            <DataGridTextColumn Header="执行时间" Binding="{Binding ExecuteTime}" Width="150" />
                            <DataGridTextColumn Header="状态" Binding="{Binding Status}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center" />
                                        <Setter Property="VerticalAlignment" Value="Center" />
                                        <Setter Property="Padding" Value="8,4" />
                                        <Setter Property="Background" Value="#333333" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTemplateColumn Header="操作" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="查看" 
                                                    Style="{StaticResource SecondaryButtonStyle}"
                                                    Padding="8,4"
                                                    FontSize="11" />
                                            <Button Content="重新执行" 
                                                    Style="{StaticResource PrimaryButtonStyle}"
                                                    Padding="8,4"
                                                    FontSize="11"
                                                    Margin="4,0,0,0" />
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <!-- 系统资源统计 -->
                <TextBlock Text="系统资源" 
                         FontSize="18" 
                         FontWeight="SemiBold"
                         Foreground="{StaticResource CyberBlueBrush}"
                         Margin="0,0,0,16" />

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- CPU使用率 -->
                    <Border Grid.Column="0" 
                            Background="#2A2A2A" 
                            CornerRadius="8" 
                            Padding="20" 
                            Margin="0,0,8,0"
                            Effect="{StaticResource MaterialDesignElevationShadow1}">
                        <StackPanel HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="Cpu64Bit" 
                                                   Width="32" 
                                                   Height="32"
                                                   Foreground="{StaticResource HighlightPurpleBrush}"
                                                   HorizontalAlignment="Center" />
                            <TextBlock Text="CPU使用率" 
                                     FontSize="14" 
                                     FontWeight="SemiBold"
                                     Foreground="White"
                                     HorizontalAlignment="Center"
                                     Margin="0,8,0,4" />
                            <TextBlock Text="45%" 
                                     FontSize="24" 
                                     FontWeight="Bold"
                                     Foreground="{StaticResource CyberBlueBrush}"
                                     HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                    
                    <!-- 内存使用率 -->
                    <Border Grid.Column="1" 
                            Background="#2A2A2A" 
                            CornerRadius="8" 
                            Padding="20" 
                            Margin="4,0"
                            Effect="{StaticResource MaterialDesignElevationShadow1}">
                        <StackPanel HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="Memory" 
                                                   Width="32" 
                                                   Height="32"
                                                   Foreground="{StaticResource HighlightPurpleBrush}"
                                                   HorizontalAlignment="Center" />
                            <TextBlock Text="内存使用率" 
                                     FontSize="14" 
                                     FontWeight="SemiBold"
                                     Foreground="White"
                                     HorizontalAlignment="Center"
                                     Margin="0,8,0,4" />
                            <TextBlock Text="62%" 
                                     FontSize="24" 
                                     FontWeight="Bold"
                                     Foreground="{StaticResource CyberBlueBrush}"
                                     HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                    
                    <!-- 磁盘使用率 -->
                    <Border Grid.Column="2" 
                            Background="#2A2A2A" 
                            CornerRadius="8" 
                            Padding="20" 
                            Margin="8,0,0,0"
                            Effect="{StaticResource MaterialDesignElevationShadow1}">
                        <StackPanel HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="Harddisk" 
                                                   Width="32" 
                                                   Height="32"
                                                   Foreground="{StaticResource HighlightPurpleBrush}"
                                                   HorizontalAlignment="Center" />
                            <TextBlock Text="磁盘使用率" 
                                     FontSize="14" 
                                     FontWeight="SemiBold"
                                     Foreground="White"
                                     HorizontalAlignment="Center"
                                     Margin="0,8,0,4" />
                            <TextBlock Text="78%" 
                                     FontSize="24" 
                                     FontWeight="Bold"
                                     Foreground="{StaticResource CyberBlueBrush}"
                                     HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page> 
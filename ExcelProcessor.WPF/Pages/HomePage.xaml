<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="ExcelProcessor.WPF.Pages.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converters="clr-namespace:ExcelProcessor.WPF.Converters"
      xmlns:local="clr-namespace:ExcelProcessor.WPF.Controls"
      Title="首页"
      Background="Transparent">

    <Page.Resources>
        <!-- 转换器资源 -->
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <converters:CardWidthConverter x:Key="CardWidthConverter" />
        <converters:TextWidthConverter x:Key="TextWidthConverter" />
        <converters:ExecutionModeToTextConverter x:Key="ExecutionModeToTextConverter" />
        <converters:ManualExecutionModeToVisibilityConverter x:Key="ManualExecutionModeToVisibilityConverter" />
        <converters:SimpleManualExecutionToVisibilityConverter x:Key="SimpleManualExecutionToVisibilityConverter" />

        <!-- 作业管理页面样式 -->
    </Page.Resources>
            
    <!-- 主布局容器 -->
    <Grid>
        <!-- 主内容区域 -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="20">
                <StackPanel>
                <!-- 欢迎信息 -->
                <TextBlock Text="欢迎使用 Excel 处理系统"
                             FontSize="24" 
                             FontWeight="Bold"
                             Foreground="White"
                         HorizontalAlignment="Center"
                         Margin="0,0,0,8" />
                
                <TextBlock Text="高效、智能的Excel数据处理解决方案"
                             FontSize="14"
                             Foreground="#CCCCCC"
                             HorizontalAlignment="Center"
                         Margin="0,0,0,32" />

                <!-- 手动执行作业标题行 -->
                <StackPanel Orientation="Horizontal" 
                           HorizontalAlignment="Left" 
                           Margin="0,0,0,16"
                           VerticalAlignment="Center">
                    <TextBlock Text="手动执行作业" 
                     FontSize="18" 
                     FontWeight="SemiBold"
                     Foreground="{StaticResource CyberBlueBrush}"
                             VerticalAlignment="Center" />
                    <TextBlock Text="{Binding ManualJobsCount, StringFormat='共 {0} 个'}"
                             FontSize="12"
                             Foreground="#888888"
                             VerticalAlignment="Center"
                             Margin="8,0,0,0" />
                </StackPanel>

                <!-- 作业卡片容器 -->
                <ItemsControl ItemsSource="{Binding ManualJobs}"
                             Margin="0,0,0,20">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" 
                                      HorizontalAlignment="Stretch"
                                      Width="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                                      ItemWidth="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource AncestorType=ScrollViewer}, Converter={StaticResource CardWidthConverter}}"
                                      ItemHeight="170" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <local:ManualJobCard x:Name="JobCard" 
                                                 Loaded="ManualJobCard_Loaded" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- 如果没有手动执行作业，显示提示信息 -->
                <Border x:Name="NoManualJobsBorder"
                        Background="#2A2A2A"
                        CornerRadius="12"
                        Padding="50,30"
                        Margin="0,0,0,20"
                        Effect="{StaticResource MaterialDesignElevationShadow1}"
                        Visibility="{Binding ManualJobsCount, Converter={StaticResource CountToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center">
                        <materialDesign:PackIcon Kind="PlayCircleOutline" 
                                               Width="56" 
                                               Height="56"
                                               Foreground="#666666"
                                               HorizontalAlignment="Center" />
                        <TextBlock Text="暂无手动执行作业" 
                                 FontSize="18" 
                                 FontWeight="SemiBold"
                                 Foreground="#666666"
                                 HorizontalAlignment="Center"
                                 Margin="0,16,0,10" />
                        <TextBlock Text="请先创建手动执行的作业配置，创建后即可在此处快速执行" 
                                 FontSize="13"
                                 Foreground="#888888"
                                 HorizontalAlignment="Center"
                                 TextWrapping="Wrap"
                                 TextAlignment="Center"
                                 MaxWidth="400"
                                 LineHeight="18" />
                    </StackPanel>
                </Border>

            <!-- 最近执行任务 -->
            <StackPanel Orientation="Horizontal" 
                       HorizontalAlignment="Left" 
                       Margin="0,0,0,16"
                       VerticalAlignment="Center">
            <TextBlock Text="最近执行任务" 
                     FontSize="18" 
                     FontWeight="SemiBold"
                     Foreground="{StaticResource CyberBlueBrush}"
                         VerticalAlignment="Center" />
                <TextBlock Text="{Binding RecentTasksCount, StringFormat='共 {0} 个'}"
                         FontSize="12"
                         Foreground="#888888"
                         VerticalAlignment="Center"
                         Margin="8,0,0,0" />
            </StackPanel>

            <Border Background="#2A2A2A"
                    CornerRadius="8"
                    Padding="20"
                    Margin="0,0,0,20"
                    Effect="{StaticResource MaterialDesignElevationShadow1}">
                
                <DataGrid x:Name="RecentTasksDataGrid"
                         ItemsSource="{Binding RecentTasks}"
                         Style="{StaticResource CustomDataGridStyle}"
                         ColumnHeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"
                         CellStyle="{StaticResource CustomDataGridCellStyle}"
                         RowStyle="{StaticResource CustomDataGridRowStyle}"
                         Height="200"
                         AutoGenerateColumns="False"
                         IsReadOnly="True">
                    
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="作业名称" Binding="{Binding JobName}" Width="*" />
                        <DataGridTextColumn Header="执行时间" Binding="{Binding ExecuteTime}" Width="150" />
                        <DataGridTextColumn Header="状态" Binding="{Binding Status}" Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center" />
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="Padding" Value="8,4" />
                                    <Setter Property="Background" Value="{Binding StatusColor}" />
                                    <Setter Property="Foreground" Value="White" />
                                    <Setter Property="FontWeight" Value="SemiBold" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="操作" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="查看" 
                                                Style="{StaticResource SecondaryButtonStyle}"
                                                Padding="8,4"
                                                FontSize="11"
                                                Click="ViewTaskDetails_Click"
                                                Tag="{Binding}" />
                                        <Button Content="重新执行" 
                                                Style="{StaticResource PrimaryButtonStyle}"
                                                Padding="8,4"
                                                FontSize="11"
                                                Margin="4,0,0,0"
                                                Click="ReExecuteTask_Click"
                                                Tag="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- 如果没有最近执行任务，显示提示信息 -->
            <Border x:Name="NoRecentTasksBorder"
                    Background="#2A2A2A"
                    CornerRadius="12"
                    Padding="50,30"
                    Margin="0,0,0,20"
                    Effect="{StaticResource MaterialDesignElevationShadow1}"
                    Visibility="{Binding RecentTasksCount, Converter={StaticResource CountToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center">
                    <materialDesign:PackIcon Kind="History" 
                                           Width="56" 
                                           Height="56"
                                           Foreground="#666666"
                                           HorizontalAlignment="Center" />
                    <TextBlock Text="暂无执行记录" 
                             FontSize="18" 
                             FontWeight="SemiBold"
                             Foreground="#666666"
                             HorizontalAlignment="Center"
                             Margin="0,16,0,10" />
                    <TextBlock Text="执行作业后将在此处显示执行记录" 
                             FontSize="13"
                             Foreground="#888888"
                             HorizontalAlignment="Center"
                             TextWrapping="Wrap"
                             TextAlignment="Center"
                             MaxWidth="400"
                             LineHeight="18" />
                </StackPanel>
            </Border>

            <!-- 系统资源统计 -->
            <TextBlock Text="系统资源" 
                     FontSize="18" 
                     FontWeight="SemiBold"
                     Foreground="{StaticResource CyberBlueBrush}"
                     Margin="0,0,0,16" />

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                    <!-- CPU使用率 -->
                <Border Grid.Column="0" 
                        Background="#2A2A2A"
                        CornerRadius="8"
                            Padding="20" 
                        Margin="0,0,8,0"
                        Effect="{StaticResource MaterialDesignElevationShadow1}">
                        <StackPanel HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="Cpu64Bit" 
                                               Width="32" 
                                               Height="32"
                                                   Foreground="{StaticResource HighlightPurpleBrush}"
                                               HorizontalAlignment="Center" />
                            <TextBlock Text="CPU使用率" 
                                 FontSize="14" 
                                 FontWeight="SemiBold"
                                 Foreground="White"
                                 HorizontalAlignment="Center"
                                 Margin="0,8,0,4" />
                            <TextBlock Text="45%" 
                                     FontSize="24" 
                                 FontWeight="Bold"
                                     Foreground="{StaticResource CyberBlueBrush}"
                                 HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                    <!-- 内存使用率 -->
                <Border Grid.Column="1" 
                        Background="#2A2A2A"
                        CornerRadius="8"
                            Padding="20" 
                            Margin="4,0"
                        Effect="{StaticResource MaterialDesignElevationShadow1}">
                        <StackPanel HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="Memory" 
                                               Width="32" 
                                               Height="32"
                                               Foreground="{StaticResource HighlightPurpleBrush}"
                                               HorizontalAlignment="Center" />
                            <TextBlock Text="内存使用率" 
                                 FontSize="14" 
                                 FontWeight="SemiBold"
                                 Foreground="White"
                                 HorizontalAlignment="Center"
                                 Margin="0,8,0,4" />
                            <TextBlock Text="62%" 
                                     FontSize="24" 
                                 FontWeight="Bold"
                                     Foreground="{StaticResource CyberBlueBrush}"
                                 HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                    <!-- 磁盘使用率 -->
                <Border Grid.Column="2" 
                        Background="#2A2A2A"
                        CornerRadius="8"
                            Padding="20" 
                        Margin="8,0,0,0"
                        Effect="{StaticResource MaterialDesignElevationShadow1}">
                        <StackPanel HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="Harddisk" 
                                               Width="32" 
                                               Height="32"
                                                   Foreground="{StaticResource HighlightPurpleBrush}"
                                               HorizontalAlignment="Center" />
                            <TextBlock Text="磁盘使用率" 
                                 FontSize="14" 
                                 FontWeight="SemiBold"
                                 Foreground="White"
                                 HorizontalAlignment="Center"
                                 Margin="0,8,0,4" />
                            <TextBlock Text="78%" 
                                     FontSize="24" 
                                 FontWeight="Bold"
                                 Foreground="{StaticResource CyberBlueBrush}"
                                     HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>
            </Grid>
        </StackPanel>
    </ScrollViewer>
    </Grid>
</Page> 
<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="ExcelProcessor.WPF.Pages.UserManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="用户管理"
      Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 页面标题和操作栏 -->
        <Border Grid.Row="0" Style="{StaticResource ConfigGroupStyle}" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 标题 -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="AccountGroup" 
                                           Width="24" 
                                           Height="24" 
                                           Foreground="{StaticResource CyberBlueBrush}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0" />
                    <TextBlock Text="用户管理" 
                             Style="{StaticResource ConfigGroupTitleStyle}"
                             FontSize="22" 
                             VerticalAlignment="Center" />
                </StackPanel>

                <!-- 操作按钮 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="AddUserButton"
                          Content="添加用户"
                          Style="{StaticResource AccentButtonStyle}"
                          Click="AddUserButton_Click"
                          Margin="0,0,8,0" />
                    
                    <Button x:Name="RefreshButton"
                          Content="刷新"
                          Style="{StaticResource ConfigButtonStyle}"
                          Click="RefreshButton_Click" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- 用户列表 -->
        <Border Grid.Row="1" Style="{StaticResource ConfigGroupStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- 搜索和筛选 -->
                <Border Grid.Row="0" Style="{StaticResource ConfigItemContainerStyle}" Margin="0,0,0,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="SearchTextBox"
                               Grid.Column="0"
                               Style="{StaticResource ConfigInputStyle}"
                               materialDesign:HintAssist.Hint="搜索用户..."
                               TextChanged="SearchTextBox_TextChanged"
                               Margin="0,0,12,0" />

                        <ComboBox x:Name="RoleFilterComboBox"
                                Grid.Column="1"
                                Style="{StaticResource ConfigComboBoxStyle}"
                                Width="150"
                                materialDesign:HintAssist.Hint="角色筛选"
                                SelectionChanged="RoleFilterComboBox_SelectionChanged"
                                Margin="0,0,12,0" />

                        <ComboBox x:Name="StatusFilterComboBox"
                                Grid.Column="2"
                                Style="{StaticResource ConfigComboBoxStyle}"
                                Width="120"
                                materialDesign:HintAssist.Hint="状态筛选"
                                SelectionChanged="StatusFilterComboBox_SelectionChanged" />
                    </Grid>
                </Border>

                <!-- 用户数据表格 -->
                <DataGrid x:Name="UsersDataGrid"
                        Grid.Row="1"
                        Style="{StaticResource CustomDataGridStyle}"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        CanUserDeleteRows="False"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True"
                        CanUserResizeRows="False"
                        CanUserSortColumns="True"
                        GridLinesVisibility="Horizontal"
                        HeadersVisibility="Column"
                        IsReadOnly="True"
                        SelectionMode="Single"
                        SelectionChanged="UsersDataGrid_SelectionChanged">

                    <DataGrid.Columns>
                        <!-- 用户ID -->
                        <DataGridTextColumn Header="ID" 
                                          Binding="{Binding Id}" 
                                          Width="60" />

                        <!-- 用户名 -->
                        <DataGridTextColumn Header="用户名" 
                                          Binding="{Binding Username}" 
                                          Width="120" />

                        <!-- 显示名称 -->
                        <DataGridTextColumn Header="显示名称" 
                                          Binding="{Binding DisplayName}" 
                                          Width="150" />

                        <!-- 邮箱 -->
                        <DataGridTextColumn Header="邮箱" 
                                          Binding="{Binding Email}" 
                                          Width="180" />

                        <!-- 角色 -->
                        <DataGridTextColumn Header="角色" 
                                          Binding="{Binding Role}" 
                                          Width="100" />

                        <!-- 状态 -->
                        <DataGridTemplateColumn Header="状态" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Status, Converter={StaticResource StatusToBrushConverter}}"
                                          CornerRadius="4"
                                          Padding="6,2"
                                          HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Status}"
                                                 Foreground="White"
                                                 FontSize="11"
                                                 FontWeight="Bold" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- 创建时间 -->
                        <DataGridTextColumn Header="创建时间" 
                                          Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd HH:mm}" 
                                          Width="140" />

                        <!-- 最后登录 -->
                        <DataGridTextColumn Header="最后登录" 
                                          Binding="{Binding LastLoginTime, StringFormat=yyyy-MM-dd HH:mm}" 
                                          Width="140" />

                        <!-- 操作 -->
                        <DataGridTemplateColumn Header="操作" Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="编辑"
                                              Style="{StaticResource MaterialDesignOutlinedButton}"
                                              Click="EditUserButton_Click"
                                              Tag="{Binding Id}"
                                              Margin="0,0,4,0" />
                                        
                                        <Button Content="删除"
                                              Style="{StaticResource MaterialDesignOutlinedButton}"
                                              Click="DeleteUserButton_Click"
                                              Tag="{Binding Id}"
                                              Margin="0,0,4,0" />
                                        
                                        <Button Content="重置密码"
                                              Style="{StaticResource MaterialDesignOutlinedButton}"
                                              Click="ResetPasswordButton_Click"
                                              Tag="{Binding Id}" />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- 消息提示 -->
        <materialDesign:Snackbar x:Name="MainSnackbar"
                               MessageQueue="{materialDesign:MessageQueue}"
                               VerticalAlignment="Bottom"
                               HorizontalAlignment="Left"
                               Margin="24" />
    </Grid>
</Page> 